\ifx\allfiles\undefined
\documentclass[12pt, a4paper, oneside, UTF8]{ctexbook}  %  这一句是新增加的
\newcommand{\pa}{\partial}





\begin{document}
%\input{../config/cover} % 单独编译时，其实不用编译封面目录之类的，如需要不注释这句即可
\else
\fi
%  ↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓ 正文部分
\chapter{}
\begin{add}
\[
\text{什么是分析力学}\begin{cases}
    \text{物理：经典力学---最小作用量原理、对称性、守恒律}\\
    \text{力学：理论力学}\begin{cases}
        \text{运动学---几何}\\
        \text{动力学}\\
        \text{动理学}
    \end{cases}\text{---工程应用}\\
    \text{数学}
\end{cases}
\]
本课程偏向力学讲法，跳过后续分析课程的内容，只考虑光滑、黎曼可积
\end{add}
\section{时空}
\begin{defn}
Newton 时空 \(S=\underbrace{T}_{\text{时间}}\times
\underbrace{X}_{\text{空间}}\)

设G是一个群，X是非定集合
\begin{gather*}
    \mu: G\times X\rightarrow x\\
    (g,x)\rightarrow g x
\end{gather*}
(1)若对任何x，y


\end{defn}
\begin{corollary}
当G是一个线性空间时，G-torsor也叫仿射空间
\begin{itemize}
    \item $G=\mathbb{R}$,时间轴T就是一个G-torsor
    \item $G=\mathbb{R}^3$,空间X就是一个G-torsor
    \item V是一个线性空间，$G=GL(V)$，
    记B是V的所有基构成的集合，设$\dim_{\mathbb{R}}V=n$,基$B=\{e_1,\dots,e_n\}$线性无关，B是一个G-torsor
    \item 势能$F=(F_x,F_y,F_z)$满足存在
    \(F_x=-\frac{\pa u}{\pa x}\quad F_y=-\frac{\pa u}{\pa y}\quad F_z=-\frac{\pa u}{\pa z}\)
    \(U(p)=\int_{p_0}^{p}F_x\,dx+F_y\,dy+F_z\,dz\)
\end{itemize}
\end{corollary}
\begin{thm}
欧氏空间的空间平移和旋转不变性

考虑$n$维欧氏空间$\mathbb{R}^n$，定义任意两点$\vec{x}, \vec{y} \in \mathbb{R}^n$间的距离为：
\[
d(\vec{x}, \vec{y}) = \|\vec{x} - \vec{y}\| = \sqrt{\sum_{i=1}^n (x_i - y_i)^2}
\]

\paragraph{1. 平移不变性}

设$\vec{a} \in \mathbb{R}^n$为平移向量，平移变换$T_{\vec{a}}: \mathbb{R}^n \to \mathbb{R}^n$定义为：
\[
T_{\vec{a}}(\vec{x}) = \vec{x} + \vec{a}
\]

\textbf{命题：}平移变换保持距离不变，即：
\[
d(T_{\vec{a}}(\vec{x}), T_{\vec{a}}(\vec{y})) = d(\vec{x}, \vec{y})
\]

\begin{proof}
计算平移后的距离：
\begin{align*}
d(T_{\vec{a}}(\vec{x}), T_{\vec{a}}(\vec{y})) 
&= \|(\vec{x} + \vec{a}) - (\vec{y} + \vec{a})\| \\
&= \|\vec{x} - \vec{y} + (\vec{a} - \vec{a})\| \\
&= \|\vec{x} - \vec{y}\| \quad \text{（向量加法消去律）} \\
&= d(\vec{x}, \vec{y})
\end{align*}
\end{proof}

\paragraph{2. 旋转不变性}

设$\vec{R}$为$n \times n$正交矩阵（$\vec{R}^\top \vec{R} = \vec{I}_n$且$\det \vec{R} = 1$），旋转变换$L_{\vec{R}}: \mathbb{R}^n \to \mathbb{R}^n$定义为：
\[
L_{\vec{R}}(\vec{x}) = \vec{R}\vec{x}
\]

\textbf{命题：}旋转变换保持距离不变，即：
\[
d(L_{\vec{R}}(\vec{x}), L_{\vec{R}}(\vec{y})) = d(\vec{x}, \vec{y})
\]

\begin{proof}
利用正交矩阵保持内积的性质：
\begin{align*}
d(L_{\vec{R}}(\vec{x}), L_{\vec{R}}(\vec{y}))
&= \|\vec{R}\vec{x} - \vec{R}\vec{y}\|= \|\vec{R}(\vec{x} - \vec{y})\| \\
&= \sqrt{(\vec{R}(\vec{x} - \vec{y}))^\top (\vec{R}(\vec{x} - \vec{y}))} \\
&= \sqrt{(\vec{x} - \vec{y})^\top \vec{R}^\top \vec{R}(\vec{x} - \vec{y})} \\
&= \sqrt{(\vec{x} - \vec{y})^\top \vec{I}_n (\vec{x} - \vec{y})} \quad \text{（正交性$\vec{R}^\top \vec{R} = \vec{I}_n$）} \\
&= \|\vec{x} - \vec{y}\|= d(\vec{x}, \vec{y})
\end{align*}
\end{proof}
\end{thm}
\begin{defn}
    惯性系

    若在一个参考系中，不受力的质点做匀速直线运动，$x''(t)=0$，则称这个参考系是惯性系。
\end{defn}
\begin{thm}
    惯性系之间的变换一点取如下形式
    \[\tilde{x}=\varphi(x)=Px+(x_0+vt)\]
\end{thm}
\begin{corollary}
    Galileo变换
    \[
\begin{pmatrix}
\tilde{\mathbf{r}} \\
\tilde{t}
\end{pmatrix}=
\begin{pmatrix}
\mathbf{P} & -\mathbf{v} \\
\mathbf{0} & 1
\end{pmatrix}
\begin{pmatrix}
\mathbf{r} \\
t
\end{pmatrix}
\]
\end{corollary}
\begin{add}
    Galileo变换的全体构成一个群G,\(S=T\times X\)中所有惯性系构成的集合是一个G-torsor
\end{add}
\section{约束}
\begin{proposition}
    质点的轨迹$x(t)$

    由NL2，应该有\(x''(t)=f(t,x(t),x'(t),x''(t)\;?\;,\dots)\)
\end{proposition}
\subsubsection*{约束的分类}
经典力学中，约束根据数学形式与物理性质分为以下类型：

\paragraph*{1. 完整约束（Holonomic Constraints）}
\subparagraph*{定义}
数学形式为仅含广义坐标 \(\mathbf{q} = (q_1, \dots, q_n)\) 和时间 \(t\) 的方程：
\begin{equation}
    f(\mathbf{q}, t) = 0,
\end{equation}
且不显含速度 \(\dot{q}_i\)，可通过积分消除自由度。

\subparagraph*{分类}
\begin{itemize}
    \item \textbf{定常约束（Scleronomic）}: \( f(\mathbf{q}) = 0 \)。\par
    例：固定摆长的单摆 \( x^2 + y^2 = l^2 \)。
    \item \textbf{非定常约束（Rheonomic）}: \( f(\mathbf{q}, t) = 0 \)。\par
    例：摆长变化的单摆 \( x^2 + y^2 = l(t)^2 \)。
\end{itemize}

\paragraph*{2. 非完整约束（Nonholonomic Constraints）}
\subparagraph*{定义}
无法表示为坐标和时间的方程，通常为不可积的微分形式：
\begin{equation}
    \sum_{i=1}^n a_i(\mathbf{q}, t) \, dq_i + a_0(\mathbf{q}, t) \, dt = 0 \quad (\text{不满足 Frobenius 条件})
\end{equation}

\subparagraph*{分类}
\begin{itemize}
    \item \textbf{线性非完整约束}: \( \sum_{i=1}^n a_i(\mathbf{q}, t) \dot{q}_i + a_0(\mathbf{q}, t) = 0 \)。\par
    例：冰刀仅沿刀刃方向滑动（横向速度为零），\(
        \dot{x} \sin \theta - \dot{y} \cos \theta = 0
    \)。
    其中：\((x, y)\) 为冰刀的位置坐标，\(\theta\) 为冰刀刀刃方向与 \(x\)-轴的夹角。\par
    例：平面滚球见例\ref{pingmiangunqiu}
    \item \textbf{非线性非完整约束}: \( f(\mathbf{q}, \dot{\mathbf{q}}, t) = 0 \)。\par
    例：涉及速度平方项的约束。
\end{itemize}

\paragraph*{3. 理想约束（Ideal Constraints）}
\subparagraph*{定义}
约束力 \(\mathbf{R}_i\) 在虚位移 \(\delta \mathbf{r}_i\) (见定义\ref{virtualdisplacement})上做功为零：
\begin{equation}
    \sum_{i=1}^n \mathbf{R}_i \cdot \delta \mathbf{r}_i = 0
\end{equation}

\subparagraph*{特点}
\begin{itemize}
    \item 约束力与虚位移正交\(\mathbf{R}_i\propto \nabla q_i\)（如光滑接触的法向力）。
    \item 例：刚体无滑滚动、不可伸长的绳索。
\end{itemize}

\paragraph*{4. 非理想约束（Nonideal Constraints）}
\subparagraph*{定义}
约束力的虚功非零：
\begin{equation}
    \sum_{i=1}^n \mathbf{R}_i \cdot \delta \mathbf{r}_i \neq 0
\end{equation}

\subparagraph*{特点}
\begin{itemize}
    \item 需显式引入运动方程（如摩擦力）。\par
    例：粗糙斜面的滑动、空气阻力。
\end{itemize}
\begin{add}
    Pfaffian 形式的定义

Pfaffian 形式（Pfaffian Form）是微分几何中的一个重要概念，在经典力学中常用于描述约束条件。它通过一次微分形式（1-form）表达对系统运动的限制，其一般形式为：
\[
\omega = \sum_{i=1}^n a_i(\mathbf{q}, t) \, dq_i + a_0(\mathbf{q}, t) \, dt
\]
其中：
\begin{itemize}
    \item \(\mathbf{q} = (q_1, q_2, \dots, q_n)\) 为广义坐标，
    \item \(a_i(\mathbf{q}, t)\) 和 \(a_0(\mathbf{q}, t)\) 是坐标和时间的函数。
\end{itemize}

在力学中，Pfaffian 形式通常表示对速度的约束。通过除以 \(dt\)，可将其写为速度的线性组合：
\[
\sum_{i=1}^n a_i(\mathbf{q}, t) \, \dot{q}_i + a_0(\mathbf{q}, t) = 0
\]
\end{add}
\begin{example}\label{pingmiangunqiu}
    \textbf{平面滚球}

\textbf{平面滚球的状态表示}

球的状态可以用以下变量表示：
\begin{itemize}
    \item \textbf{球心坐标}：$(x, y)$ 表示球心在平面上的位置。
    \item \textbf{欧拉角}：$(\varphi, \theta, \psi)$ 表示球的姿态，其中：
    \begin{itemize}
        \item $\varphi$ 是绕 $z$ 轴的进动角（precession），
        \item $\theta$ 是绕 $x$ 轴的章动角（nutation），
        \item $\psi$ 是绕 $z$ 轴的自旋角（spin）。
    \end{itemize}
\end{itemize}

\textbf{非完整约束条件}

球在平面上滚动而无滑动的条件可以用以下约束方程表示：
\[
\begin{cases}
\dot{x} = r (\omega_y \cos \psi - \omega_x \sin \psi), \\
\dot{y} = r (\omega_x \cos \psi + \omega_y \sin \psi),
\end{cases}
\]
其中：
\begin{itemize}
    \item $r$ 是球的半径，
    \item $\omega_x$ 和 $\omega_y$ 是球绕 $x$ 和 $y$ 轴的角速度分量。
\end{itemize}

\textbf{欧拉角与角速度的关系}

欧拉角的导数与角速度之间的关系可以通过以下公式表示：
\[
\begin{cases}
\omega_x = \dot{\varphi} \sin \theta \sin \psi + \dot{\theta} \cos \psi, \\
\omega_y = \dot{\varphi} \sin \theta \cos \psi - \dot{\theta} \sin \psi, \\
\omega_z = \dot{\varphi} \cos \theta + \dot{\psi}.
\end{cases}
\]

\textbf{状态方程}

综合以上关系，球的状态方程可以表示为：
\[
\begin{cases}
\dot{x} = r (\dot{\varphi} \sin \theta \cos \psi - \dot{\theta} \sin \psi), \\
\dot{y} = r (\dot{\varphi} \sin \theta \sin \psi + \dot{\theta} \cos \psi), \\
\dot{\varphi} = \omega_x \sin \psi + \omega_y \cos \psi, \\
\dot{\theta} = \omega_x \cos \psi - \omega_y \sin \psi, \\
\dot{\psi} = \omega_z - \dot{\varphi} \cos \theta.
\end{cases}
\]
\end{example}
\section{广义坐标}
考虑\(\mathbb{R}^n\)中的\(m\)个约束\(g_\alpha(x)=0\; ,\; \alpha=1,\cdots,m\)
\begin{defn}[k维曲面]
    设 $ M $ 是 $\mathbb{R}^n$ 的子集。若存在 $ k \in \mathbb{N} $，$ k \leq n $，使得对于任意的 $ x_0 \in M $，存在 $ x_0 $ 在 $\mathbb{R}^n$ 中的开邻域 $\mathcal{U}$，以及一个微分同胚
    $
    \varphi: \mathcal{U} \to I,
    $
    其中 $ I = \{ q \in \mathbb{R}^n \mid q = (q_1, \dots, q_n), |q_i| < 1, i = 1, \dots, n \} $，且满足：
    $
    \varphi(x) = (q_1(x), \dots, q_n(x)),
    $
    使得对于所有 $ x \in \mathcal{U} \cap M $，有
    $
    (q_{k+1}(x), \dots, q_n(x)) = 0,
    $
    并且雅可比矩阵
    $
    \left( \frac{\partial q_i}{\partial x_j} \right)_{1 \leq i,j \leq n}
    $
    在每一点 $ x \in \mathcal{U} \cap M $ 处满秩（即其前 $ k $ 列是线性无关的）。则称 $ M $ 是 $\mathbb{R}^n$ 中的一个 $ k $-维光滑曲面。
    \end{defn}
\begin{example}
    球面\((k =n-1)\)
    \(x_1^2 + x_2^2 + \dots + x_n^2 = r^2\),其中\(r>0\) 是球面的半径。
\end{example}
\begin{example}
    环面\((k=n-2)\)
    \(\left( \sqrt{x_1^2 + x_2^2 + \dots + x_{n-1}^2} - R \right)^2 + x_n^2 = r^2
\)其中 \(R>r>0\) 是环面的主半径和副半径。
\end{example}
\begin{thm}
    正则值定理

    设 $ F \in C^\infty(\mathbb{R}^n, \mathbb{R}) $，定义 $ M = F^{-1}(0) $。若对任意 $ x \in M $，有 $ dF_x \neq 0 $，则 $ M $ 是一个 $ (k=n-1) $ 维光滑曲面。
\end{thm}
广义坐标的定义如下：

设 $ M $ 为一个 $ n $-维光滑流形。若 $ M $ 上的一个开集 $ U $ 与 $ \mathbb{R}^n $ 之间
存在一个平滑的同胚映射 $ \varphi: U \rightarrow \mathbb{R}^n $，则称 $ (U, \varphi) $ 
为 $ M $ 上的一组广义坐标，记作 $ (q^1, q^2, \dots, q^n) $，其中 $ q^i $ 是映射 $ \varphi $ 的分量函数。

可以表示为：
\[
\varphi: U \subset M \rightarrow \mathbb{R}^n, \quad p \mapsto (q^1(p), q^2(p), \dots, q^n(p))
\]
其中，雅可比矩阵 $ \left( \frac{\partial \varphi^i}{\partial x^j} \right) $ 在每一点 $ p \in U $ 处满秩。
\begin{defn}
曲线坐标系中的速度（切向量）

在曲线坐标系中，曲线的速度（切向量）可以表示为：
\[
\mathbf{v} = \frac{d\mathbf{r}}{dt} = \sum_{i=1}^{n} \frac{dx^i}{dt} \frac{\partial \mathbf{r}}{\partial x^i}
\]
其中，\(\mathbf{r}\) 是位置矢量，\(x^i\) 是曲线坐标系的坐标，\(t\) 是参数（通常是时间）。
\end{defn}
\begin{defn}
    流形的切丛

设 \(M\) 是一个 \(n\) 维光滑流形，\(p \in M\) 是流形上的一点。流形 \(M\) 在点 \(p\) 处的切空间 \(T_p M\) 是
所有在 \(p\) 点处的切向量的集合。流形 \(M\) 的切丛 \(TM\) 定义为所有切空间的并集：
\[
TM = \bigcup_{p \in M} T_p M
\]
切丛 \(TM\) 是一个 \(2n\) 维的光滑流形，其局部坐标可以表示为 \((x^1, \dots, x^n, v^1, \dots, v^n)\)，
其中 \((x^1, \dots, x^n)\) 是流形 \(M\) 上的局部坐标，\((v^1, \dots, v^n)\) 是切空间 \(T_p M\) 中的向量分量。
\end{defn}
\begin{defn}
    在曲线坐标系中，曲线的加速度是速度（切向量）对时间的导数。

    直观上，加速度可以表示为：
    \[
    \mathbf{a} = \frac{d\mathbf{v}}{dt} = \frac{d^2\mathbf{r}}{dt^2}
    \]

    加速度具体表达式为：
\begin{align*}
    a_i=\ddot{x_i}&=\dv{t}\left( \sum_{\alpha=1}^{k}\frac{\pa x_i}{\pa q_\alpha}\dot{q_\alpha}\right)\\
    &\begin{aligned}=\sum_{\alpha=1}^{k}\frac{\pa x_i}{\pa q_\alpha}
        &\ddot{q_\alpha}+\sum_{\alpha,\beta=1}^{k}\pdv{x_i}{q_\alpha}{q_\beta}
        \dot{q_\alpha}\dot{q_\beta}\\
        &\downarrow\\
        &\text{广义加速度}
    \end{aligned}
\end{align*}
\end{defn}
\begin{defn}
    延拓坐标系
\begin{gather*}
    (q_1,\cdots,q_k,\dot{q_1},\cdots,\dot{q_k},\ddot{q_1},\cdots,\ddot{q_k}
)    \\ (\tilde{q_1},\cdots,\tilde{q_k},\dot{\tilde{q_1}},\cdots,\dot{\tilde{q_k}},\ddot{\tilde{q_1}},\cdots,\ddot{\tilde{q_k}}
)    \\ \ddot{\tilde{q_\alpha}}=
\sum_{\beta=1}^{k} \frac{\partial \tilde{q_\alpha}}{\partial q_{\beta}} \ddot{q_b} 
+ \sum_{\beta,\gamma=1}^{k} \frac{\partial^{2} \tilde{q_\alpha}}
{\partial q_{\beta} \partial q_{\gamma}} \dot{q_\beta} \dot{q_\gamma}
\\\frac{\partial\dot{\tilde{q_\alpha}}}{\partial \dot{q_{\beta}}}
=\frac{\partial\tilde{q_\alpha}}{\partial q_{\beta}}\qquad
\frac{\partial\ddot{\tilde{q_\alpha}}}{\partial \ddot{q_{\beta}}}
=\frac{\partial\tilde{q_\alpha}}{\partial q_{\beta}}
\end{gather*}  
\begin{align*}
    \frac{\partial\ddot{\tilde{q_\alpha}}}{\partial \dot{q_{\beta}}}
&=\sum_{r_{1},r_{2}=1}^{k}\frac{\partial^{2}\tilde{q_\alpha}}
{\partial q_{r_1}\partial q_{r_2}}
\frac{\partial}{\partial \dot{q_\beta}}(\dot{q_{r_{1}}},\dot{q_{r_{2}}})
\\&=\sum_{r_{2}=1}^{k}\frac{\partial^{2}\tilde{q_\alpha}}
{\partial q_{\beta}\partial q_{r_2}}\dot{q_{r_{2}}}+
\sum_{r_{1}=1}^{k}\frac{\partial^{2}\tilde{q_\alpha}}
{\partial q_{r_1}\partial q_{\beta}}\dot{q_{r_{1}}}
\\&=2\sum_{r=1}^{k}\frac{\partial^{2}\tilde{q_\alpha}}
{\partial q_{r}\partial q_{\beta}}\dot{q_{r}}
=\boxed{2\dv{t}\left(\frac{\pa \tilde{q_\alpha}}{\pa q_\beta}\right)}
=\boxed{2\pdv{\dot{\tilde{q_\alpha}}}{q_\beta}}
\end{align*}  
\end{defn}
\begin{proposition}\label{拉氏量对广义坐标求导}
    记\(q_{\alpha,s}\left(\dv{t}\right)^s\left(q_\alpha(t)\right)\)
    \(\tilde{q}_{\alpha,s}\left(\dv{t}\right)^s\left(\tilde{q_\alpha}(t)\right)\)
    ，问题\(\displaystyle
        \frac{\pa \tilde{q}_{\alpha,s}}{\pa \tilde{q}_{\beta,t}}=\;?\qquad
\)

若\(s<t\)，则\(=0\)。下设\(s>t\)：
\[
\frac{\partial\tilde{q}_{\alpha, s}}{\partial q_{\beta,t}}=
\begin{pmatrix}
s \\
t
\end{pmatrix}
\left(\frac{d}{dt}\right)^{s-t}
\left(\frac{\partial\tilde{q}_\alpha}{\partial q_\beta}\right)
\]
\begin{proof}
若\(f=f(q,q',q'',\cdots)\),则
\[
\dv{f}{t}=\sum_{\alpha,s}\frac{\pa f}{\pa q^{\alpha,s}}\dv{q^{\alpha,s}}{t}
=\sum_{\alpha,s}q^{\alpha,s+1}\frac{\pa f}{\pa q^{\alpha,s}}
\]
记\(\pa =\sum_{\alpha,s}q^{\alpha,s+1}\frac{\pa }{\pa q^{\alpha,s}}\)
\[
    \frac{\partial}{\partial q_{\alpha,s}}\pa^t=
    \sum_{j=0}^{t}
    \begin{pmatrix}
    t\\
    j
    \end{pmatrix}
    \pa^{t-j}
    \left(\frac{\partial}{\partial q_{\alpha,s-j}}\right)
\]
\begin{align*}
    \frac{\pa \tilde{q}_{\alpha,s}}{\pa \tilde{q}_{\beta,t}}
    &=\frac{\pa }{\pa q_{\beta,t}}\pa ^s(\tilde{q_\alpha})\\
    &=\sum_{j=0}^{s}
    \begin{pmatrix}
    s\\
    j
    \end{pmatrix}
    \pa^{s-j}
    \left(\frac{\partial \tilde{q_\alpha}}{\partial q_{\beta,t-j}}\right)
    =\begin{pmatrix}
        s\\
        j
        \end{pmatrix}
        \pa^{s-j}
        \left(\frac{\partial \tilde{q_\alpha}}{\partial q_\beta}\right)    
\end{align*}
\end{proof}
\end{proposition}
\begin{lemma}
    \[
\frac{\partial}{\partial q_{\alpha,s}}\pa^t=
\sum_{j=0}^{t}
\begin{pmatrix}
t\\
j
\end{pmatrix}
\pa^{t-j}
\left(\frac{\partial}{\partial q_{\alpha,s-j}}\right)
\]
\begin{proof}
    \(t=0\)成立，
    \begin{align*}
        t=1\qquad
        \frac{\partial}{\partial q_{\alpha,s}}\pa f
        &=\pa \frac{\partial f}{\partial q_{\alpha,s}}
        +\frac{\pa f}{\pa q_{\alpha,s-1}}\\
        =\frac{\partial}{\partial q_{\alpha,s}}
        \left(\sum_{\beta,t}q_{\beta,t+1}\frac{\pa f}{\pa q_{\beta,t}}\right)
        &=\sum_{\beta,t}q_{\beta,t+1}\frac{\pa^2 f}{\pa q_{\beta,t} \pa q_{\alpha,s}}
        +\frac{\pa f}{\pa q_{\alpha,s-1}}=\\
        \alpha=\beta\quad&\quad s=t+1
    \end{align*}
    下设\(t-1\)成立
    \begin{align*}
        \frac{\partial}{\partial q_{\alpha,s}}\pa^t
        &=\left(\frac{\partial}{\partial q_{\alpha,s}}\pa \right)\pa^{t-1}
        =\left(\pa \frac{\partial }{\partial q_{\alpha,s}}
        +\frac{\pa }{\pa q_{\alpha,s-1}}\right)\pa ^{t-1}\\
        &=\pa \sum_{j=0}^{t-1}
        \begin{pmatrix}
        t-1\\
        j
        \end{pmatrix}
        \pa^{t-1-j}
        \left(\frac{\partial}{\partial q_{\alpha,s-j}}\right)
        +\sum_{j=0}^{t-1}
        \begin{pmatrix}
        t-1\\
        j
        \end{pmatrix}
        \pa^{t-1-j}
        \left(\frac{\partial}{\partial q_{\alpha,s-1-j}}\right)\\
        &=\sum_{j=0}^{t-1}
        \begin{pmatrix}
        t-1\\
        j
        \end{pmatrix}
        \pa^{t-j}
        \left(\frac{\partial}{\partial q_{\alpha,s-j}}\right)
        +\sum_{j'=1}^{t}
        \begin{pmatrix}
        t-1\\
        j'-1
        \end{pmatrix}
        \pa^{t-1-j}
        \left(\frac{\partial}{\partial q_{\alpha,s-j'}}\right)\\
        &=\pa^t\frac{\pa }{\pa q_{\alpha,s}}+
        \sum_{j'=1}^{t}
    \underbrace{\left(\begin{pmatrix}
        t-1\\
        j'
    \end{pmatrix}+
    \begin{pmatrix}
    t-1\\
    j'-1
    \end{pmatrix}\right)}_{\begin{pmatrix}
        t\\j'\end{pmatrix}}
        \pa^{t-1-j}
        \left(\frac{\partial}{\partial q_{\alpha,s-j'}}\right)
    \end{align*}
\end{proof}
\end{lemma}
\begin{defn}
    \((q_1,\cdots,q_k)\)构型空间\par
    \((q_1,\cdots,q_k,\dot{q_1},\cdots,\dot{q_k})\)相空间(M的切丛)\par
    \((q_1,\cdots,q_k,p_1,\cdots,p_k)\)相空间(M的余切丛)\par
    \((q_1,\cdots,q_k,\ddot{q_1},\cdots,\ddot{q_k})\)M的jet丛
\end{defn}
\section{约束力}
\begin{example}
    平面自由质点，满足约束\(f(x,y)=0\)，理想约束，动能守恒。
    \begin{gather*}
\begin{aligned}
    \begin{cases}
        f(x(t),y(t))=0\\
        \dot{x}^2+\dot{y}^2=k=\frac{2E_k}{m}
    \end{cases}&\Rightarrow
\begin{cases}
\frac{\pa f}{\pa x}\dot{x}+\frac{\pa f}{\pa y}\dot{y}=0
\Rightarrow\nabla f\cdot\vec{v}=0\\
\dot{x}\ddot{x}+\dot{y}\ddot{y}=0
\Rightarrow\vec{v}\cdot\vec{a}=0
\end{cases}\\&
\Rightarrow
\ddot{x}=\lambda\frac{\pa f}{\pa x}\qquad 
\ddot{y}=\lambda\frac{\pa f}{\pa y}\\
\end{aligned}\\
\begin{aligned}
    \dv[2]{t}\left(f(x(t),y(t))\right)
&=\left(f_{xx}x'+f_{xy}y'\right)x'+f_x x''
+\left(f_{xy}x'+f_{yy}y'\right)y'+f_y y''
\\&=\left(f_{xx}x'^2+2f_{xy}x'y'+f_{yy}y'^2\right)
+\lambda\left(f_x^2+f_y^2\right)=0
\\&\Rightarrow\lambda=-\frac{1}{f_x^2+f_y^2}
\left(f_{xx}x'^2+2f_{xy}x'y'+f_{yy}y'^2\right)\\
\dot{y}=-\frac{f_x}{f_y}\dot{x}
\qquad\dot{x}^2=\frac{k}{1+\frac{f_x^2}{f_y^2}}
&\qquad=-\frac{1}{f_x^2+f_y^2}\left(f_{xx}+2f_{xy}\left(-\frac{f_x}{f_y}\right)
+f_{yy}\frac{f_x^2}{f_y^2}\right)\frac{k}{1+\frac{f_x^2}{f_y^2}}\\
&\qquad=-\frac{k}{(f_x^2+f_y^2)^2}
\left(f_{xx}-2f_{xy}f_xf_y+f_{yy}f_x^2\right)
\end{aligned}\\
\Downarrow\\
\begin{cases}
    R_x=mf_x \lambda\\
    R_y=mf_y \lambda
\end{cases}
    \end{gather*}
\end{example}
\begin{defn}
    一般的约束力

    设系统由 \( n \) 个变量 \( \mathbf{q} = (q_1, q_2, \dots, q_n) \) 描述，系统受到 \( m \) 个约束条件：
    \[
    f_i(\mathbf{q}) = 0 \quad \text{对于} \quad i = 1, 2, \dots, m,
    \]
    其中 \( f_i: \mathbb{R}^n \to \mathbb{R} \) 是光滑函数。
    
    约束力 \( \mathbf{Q} \) 定义为：
    \[
    \mathbf{Q} = \sum_{i=1}^m \lambda_i \, \nabla f_i,
    \]
    其中 \( \lambda_i \) 是拉格朗日乘数，\( \nabla f_i \) 是 \( f_i \) 的梯度向量：
    \[
    \nabla f_i = \left( \frac{\partial f_i}{\partial q_1}, \frac{\partial f_i}{\partial q_2}, \dots, \frac{\partial f_i}{\partial q_n} \right).
    \]
    约束力的第 \( j \) 个分量为：
    \[
    Q_j = \sum_{i=1}^m \lambda_i \frac{\partial f_i}{\partial q_j}.
    \]
\end{defn}
\begin{example}\label{tribar}
三根杆，分别记为杆 1、杆 2 和杆 3。
杆 1 的一端固定在地上，可以自由转动。
杆 3 的一端固定在墙上，可以自由转动。
杆 1 和杆 2 ，杆 2 和杆 3通过一个铰链连接，可以自由转动。

    给定几何约束：
    \[
    \begin{cases}
    q_1 = (x_1 - x_0)^2 + (y_1 - y_0)^2 - l_1^2 = 0 \\
    q_2 = (x_2 - x_1)^2 + (y_2 - y_1)^2 - l_2^2 = 0 \\
    q_3 = (x_3 - x_2)^2 + (y_3 - y_2)^2 - l_3^2 = 0
    \end{cases}
    \]
    拉格朗日乘数条件：
    \[
    \frac{F_{1,x}}{x_1} = \frac{F_{1,y}}{y_1} = \lambda_1 \qquad
    \frac{F_{2,x}}{x_2 - x_1} = \frac{F_{2,y}}{y_2 - y_1} = \lambda_2 \qquad
    \frac{F_{3,x}}{a - x_2} = \frac{F_{3,y}}{b - y_2} = \lambda_3
    \]
    以及力的平衡条件：
    \[
    \begin{cases}
    F_{1,x} = F_{2,x} \\
    F_{1,y} + m_{1,y} = F_{2,y}
    \end{cases}
    \qquad
    \begin{cases}
    F_{2,x} = F_{3,x} \\
    F_{2,y} + m_{2,y} = F_{3,y}
    \end{cases}
    \]
\begin{solution}
    拉格朗日乘数法(用虚功原理解该问题见例\ref{tribarvw})

    \noindent \textbf{步骤 1：几何约束线性化} \\
    对几何约束 \( q_1, q_2, q_3 \) 进行线性化：
    \[
    \begin{cases}
    2(x_1 - x_0) \delta x_1 + 2(y_1 - y_0) \delta y_1 = 0, \\
    2(x_2 - x_1) \delta x_2 + 2(y_2 - y_1) \delta y_2 = 0, \\
    2(x_3 - x_2) \delta x_3 + 2(y_3 - y_2) \delta y_3 = 0.
    \end{cases}
    \]

    \noindent \textbf{步骤 2：拉格朗日乘数条件} \\
    将拉格朗日乘数条件代入力的表达式：
    \[
    \begin{cases}
    F_{1,x} = \lambda_1 x_1, \\
    F_{1,y} = \lambda_1 y_1, \\
    F_{2,x} = \lambda_2 (x_2 - x_1), \\
    F_{2,y} = \lambda_2 (y_2 - y_1), \\
    F_{3,x} = \lambda_3 (a - x_2), \\
    F_{3,y} = \lambda_3 (b - y_2).
    \end{cases}
    \]
    
    \noindent \textbf{步骤 3：力的平衡条件} \\
    将力的平衡条件代入拉格朗日乘数条件：
    \[
    \begin{cases}
    \lambda_1 x_1 = \lambda_2 (x_2 - x_1), \\
    \lambda_1 y_1 + m_{1,y} = \lambda_2 (y_2 - y_1), \\
    \lambda_2 (x_2 - x_1) = \lambda_3 (a - x_2), \\
    \lambda_2 (y_2 - y_1) + m_{2,y} = \lambda_3 (b - y_2).
    \end{cases}
    \]
    
    \noindent \textbf{步骤 4：解拉格朗日乘数} \\
    通过力的平衡条件，解出拉格朗日乘数：
    \[
    \begin{cases}
    \lambda_1 = \frac{\lambda_2 (x_2 - x_1)}{x_1}, \\
    \lambda_2 = \frac{\lambda_3 (a - x_2)}{x_2 - x_1}, \\
    \lambda_3 = \frac{\lambda_2 (y_2 - y_1) + m_{2,y}}{b - y_2}.
    \end{cases}
    \]
    
    \noindent \textbf{步骤 5：解坐标变量} \\
    将拉格朗日乘数代入几何约束，解出坐标变量：
    \[
    \begin{cases}
    x_1 = x_0 + l_1 \cos \theta_1, \\
    y_1 = y_0 + l_1 \sin \theta_1, \\
    x_2 = x_1 + l_2 \cos \theta_2, \\
    y_2 = y_1 + l_2 \sin \theta_2, \\
    x_3 = x_2 + l_3 \cos \theta_3, \\
    y_3 = y_2 + l_3 \sin \theta_3,
    \end{cases}
    \]
    其中 \( \theta_1, \theta_2, \theta_3 \) 是各杆的转动角度。
\end{solution}
\end{example}
\section{虚功原理}
\begin{defn}\label{virtualdisplacement}
    虚位移

    构型空间M的切空间中的向量
    \[ M \qquad p \in M \qquad \vec{v} \in T_{p}M \]
\end{defn}
\begin{principle}
    虚功原理

    静力平衡$\Leftrightarrow$ 主动力在虚位移上的虚功等于零
    \[
    \delta W=\vec{F}\cdot\vec{v}=0\;,\;\forall\vec{v}\in T_p M
    \]
    在考虑理想约束的情况下，虚功原理可以进一步表示为约束力的梯度形式。
\begin{enumerate}
    \item 理想约束意味着约束在虚位移上不做功。因此，虚功原理可以表示为：
    \[
    \sum_{j} Q_j \delta q_j = 0
    \]
    其中，\( Q_j \) 是广义力，\( \delta q_j \) 是广义坐标的虚位移。
    \item 对于理想约束，约束 \( \mathbf{R} \) 满足：
    \[
    \mathbf{R} \cdot \delta \mathbf{r} = 0
    \]
    \item 在广义坐标下，约束条件可以表示为梯度形式。假设约束方程为 \( f_k(q_1, q_2, \dots, q_n) = 0 \)，则虚位移 \( \delta q_j \) 必须满足：
    \[
    d f_k =\sum_{j} \frac{\partial f_k}{\partial q_j} \delta q_j = 0
    \]
    \item 因此，虚功原理在理想约束下的完整表示为：
    \[
    \sum_{j} \left( Q_j - \sum_{k} \lambda_k \frac{\partial f_k}{\partial q_j} \right) \delta q_j = 0
    \]
    其中，\( \lambda_k \) 是拉格朗日乘子，用于引入约束条件。
\end{enumerate}
\end{principle}
\begin{example}\label{tribarvw}
    用虚功原理解例\ref{tribar}。
    \begin{solution}
        
\noindent \textbf{步骤 1：虚位移关系}
\[
\begin{cases}
2(x_1 - x_0) \delta x_1 + 2(y_1 - y_0) \delta y_1 = 0, \\
2(x_2 - x_1) \delta x_2 + 2(y_2 - y_1) \delta y_2 = 0, \\
2(x_3 - x_2) \delta x_3 + 2(y_3 - y_2) \delta y_3 = 0.
\end{cases}
\]

\noindent \textbf{步骤 2：虚功方程}
\(
F_{1,x} \delta x_1 + F_{1,y} \delta y_1 + F_{2,x} \delta x_2 + F_{2,y} \delta y_2 + F_{3,x} \delta x_3 + F_{3,y} \delta y_3 = 0.
\)

\noindent \textbf{步骤 3：代入虚位移关系} \\
将虚位移关系代入虚功方程，得到：
\[
F_{1,x} \delta x_1 + F_{1,y} \delta y_1 + F_{2,x} \delta x_2 + F_{2,y} \delta y_2 + F_{3,x} \delta x_3 + F_{3,y} \delta y_3 = 0.
\]
利用几何约束的虚位移关系，消去 \( \delta x_3 \) 和 \( \delta y_3 \)：
\[
F_{1,x} \delta x_1 + F_{1,y} \delta y_1 + F_{2,x} \delta x_2 + F_{2,y} \delta y_2 + F_{3,x} \left( \frac{x_3 - x_2}{x_2 - x_1} \delta x_2 \right) + F_{3,y} \left( \frac{y_3 - y_2}{y_2 - y_1} \delta y_2 \right) = 0.
\]

\noindent \textbf{步骤 4：力的平衡条件} \\
由于虚位移 \( \delta x_1, \delta y_1, \delta x_2, \delta y_2 \) 是任意的，系数必须为零：
\[
\begin{cases}
F_{1,x} = 0, \\
F_{1,y} = 0, \\
F_{2,x} + F_{3,x} \left( \frac{x_3 - x_2}{x_2 - x_1} \right) = 0, \\
F_{2,y} + F_{3,y} \left( \frac{y_3 - y_2}{y_2 - y_1} \right) = 0.
\end{cases}
\]

\noindent \textbf{步骤 5：解力的平衡方程} \\
通过力的平衡条件，解出各力的大小和方向：
\[
\begin{cases}
F_{1,x} = 0, \\
F_{1,y} = 0, \\
F_{2,x} = -F_{3,x} \left( \frac{x_3 - x_2}{x_2 - x_1} \right), \\
F_{2,y} = -F_{3,y} \left( \frac{y_3 - y_2}{y_2 - y_1} \right).
\end{cases}
\]
\begin{zhu}
    拉格朗日乘数 \( \lambda_i \) 反映了约束力的大小和方向，
    而虚功原理通过虚位移关系直接描述了力的平衡。
\end{zhu}
    \end{solution}
\end{example}
\begin{add}
虚位移与虚速度的科学史(\textbf{此部分内容AIGC})

\noindent \textbf{1. 虚速度的起源} 

虚速度的概念最早可以追溯到 17 世纪，由瑞士数学家 \textbf{约翰·伯努利}（Johann Bernoulli）在 1717 年提出。他在写给皮埃尔·瓦里尼翁的信中首次提出了虚速度原理，用于描述系统在平衡状态下可能发生的微小运动。

\noindent \textbf{2. 虚速度原理} 

虚速度原理的核心思想是：在平衡状态下，系统中所有力的虚功之和为零。数学表达式为：
\[
\sum_{i=1}^n \mathbf{F}_i \cdot \delta \mathbf{v}_i = 0,
\]
其中 \( \mathbf{F}_i \) 是作用在第 \( i \) 个质点上的力，\( \delta \mathbf{v}_i \) 是虚速度。

\noindent \textbf{3. 从虚速度到虚位移} 

随着分析力学的发展，虚速度的概念逐渐被推广为 \textbf{虚位移}（virtual displacement）。虚位移是系统在平衡状态下可能发生的微小位移，由 \textbf{约瑟夫-路易·拉格朗日}（Joseph-Louis Lagrange）在其 1788 年出版的《分析力学》中正式提出。

\noindent \textbf{4. 虚位移与虚速度的关系} 

虚位移和虚速度本质上是相关的：
\(\displaystyle \delta \mathbf{r}_i = \int \delta \mathbf{v}_i \, dt\)

在静力学问题中，虚速度和虚位移可以互换使用。

\noindent \textbf{5. 科学史的意义} 

虚速度和虚位移的概念是分析力学的基础，为后来的 \textbf{拉格朗日力学} 和 \textbf{哈密顿力学} 提供了重要的理论工具。虚功原理和虚速度原理在工程力学和物理学中有广泛应用，例如结构分析和多体动力学。

\begin{enumerate}
\item 理论的普适性 \\
- 虚速度最初用于静力学问题，而虚位移可以推广到动力学问题。 \\
- 虚位移是虚速度对时间的积分，能够更自然地描述系统在时间上的微小变化。

\item 数学表达的简洁性 \\
- 虚速度涉及速度的概念，需要引入时间变量，增加了问题的复杂性。 \\
- 虚位移直接描述系统在空间中的微小变化，数学表达更加简洁。

\item 物理意义的清晰性 \\
- 虚速度描述的是微小速度，较为抽象。 \\
- 虚位移描述的是微小位移，更贴近实际物理现象。
\end{enumerate}
\end{add}
\begin{thm}
    若主动力有势，则在平衡情况下，势能取极值。
\end{thm}
\begin{example}
    悬链线问题是指在重力作用下，一根均匀、
    柔软且不可伸长的链条悬挂在两个固定点之间所形成的曲线形状。
    我们需要在构型空间上推导出这条曲线的方程。

    假设与符号定义

    \noindent
    \begin{tabular}{|c|c|c|}
        \hline
        \begin{minipage}{0.3\linewidth}
            \begin{itemize}
              \item 曲线的方程为 \( y(x) \)。
            \end{itemize}
          \end{minipage} &
        \begin{minipage}{0.3\linewidth}
          \begin{itemize}
            \item 链条的线密度为 \( \rho \)。
          \end{itemize}
        \end{minipage} &
        \begin{minipage}{0.3\linewidth}
          \begin{itemize}
            \item 重力加速度为 \( g \)。
          \end{itemize}
        \end{minipage} 
        \\ \hline
      \end{tabular} 
    \begin{solution}
        \begin{gather*}
            \tilde{y}(x)=y(x)+\delta y(x)\\
\tilde{y}(a)=l_{1}\quad\tilde{y}(-a)=l_{2}\quad\Rightarrow\quad\delta y(a)=0\quad\delta y(-a)=0
\\\tilde{y}'(x)=y(x)+\delta y'(x)
        \end{gather*}
\begin{align*}
    \rho g =1\quad
\mathcal{U}(y)&=\int_{-a}^{a}y(x)\sqrt{1+y^{\prime}(x)^{2}}dx\\
\delta \mathcal{U}(y)&=\mathcal{U}(y+\delta y)-\mathcal{U}(y)+\omicron(\delta y)\\
&=\int_{-a}^{a}(y(x)+\delta y (x))\sqrt{1+(y'(x)+ \delta y'(x))^{2}}\,dx-\mathcal{U}(y)
\\&=\int_{-a}^{a}(y(x)+\delta y (x))\sqrt{1+y'(x)^{2}+2y'(x) \delta y'(x)}\,dx-\mathcal{U}(y)
\\&= \int_{-a}^{a} \delta y(x) \sqrt{1 + y'(x)^2} 
+ \frac{y(x) y'(x) \delta y'(x)}{\sqrt{1 + y'(x)^2}} \, dx + \omicron(\delta y) \\
\begin{gathered}
    \delta y'(x)=(\delta y(x))'\\
    \text{将第二项进行分部积分}
\end{gathered} \quad
&= \int_{-a}^{a} \delta y(x) \underbrace{\left(\sqrt{1 + y'(x)^2} 
- \left(\frac{y(x) y'(x) }{\sqrt{1 + y'(x)^2}}\right)' \right)}
_{\delta y \text{对应的广义力}} \, dx
\\& \quad+\frac{y(x) y'(x) }{\sqrt{1 + y'(x)^2}} \delta y\vert^a_{-a}
\\&\Rightarrow \sqrt{1 + y'(x)^2} 
- \left(\frac{y(x) y'(x) }{\sqrt{1 + y'(x)^2}}\right)' =0
\\&\Rightarrow \sqrt{1 + y'(x)^2} 
- \frac{y'(x)^2 + y(x) y''(x)}{\sqrt{1 + y'(x)^2}} 
+ \frac{y(x) y'(x)^2 y''(x)}{(1 + y'(x)^2)^{3/2}} = 0 
\\&\Rightarrow y y'' = 1 + y^2 
\\&\Rightarrow y(x) = C_1 \cosh\left( \frac{x - C_2}{C_1} \right) 
\end{align*}
\end{solution}
\end{example}
\begin{example}
    肥皂泡

表面张力 \(\Rightarrow\) 面积最小。
\[
S(y) = \int_{-a}^{a}k y(x) \sqrt{1 + y'^{2}(x)} \, dx
\]
\end{example}
\section{达朗贝尔原理}
动力学中，由NL2
\((m_i \ddot{x}_i=F_i+(R_j)_i)\)，移项得
\[\vec{F}+R_j-G=0\;,\;\text{其中}G_i=m_i\ddot{x}_i
\]

静力学中，由虚功原理得
\(\delta W =(\vec{F}-G)\cdot \delta r =0\)
\begin{thm}
    欧拉\textminus 拉格朗日方程
\noindent
设系统的广义坐标为 \( q_1, \cdots, q_k \;,\; k = n-m\)
\begin{gather*}
    x_i = x_i(q), i=1,\cdots,n.
\\
\delta X = \begin{pmatrix}
\delta x_{1} \\
\vdots \\
\delta x_{n}
\end{pmatrix} \qquad 
\delta x_i = \sum_{l=1}^{k} \frac{\partial x_{i}}{\partial q_{l}} \delta q_{l}
\end{gather*}
\begin{align*}
    \delta W &= \sum_{i=1}^n (F_i - m_i \ddot{x}_i) \delta x_i
    = \sum_{l=1}^k  \left( \sum_{i=1}^n F_i \frac{\partial x_i}{\partial q_l} \right) \delta q_l\\
        T &= \frac{1}{2} \sum_{i=1}^{n} m_{i} \dot{x}_{i}^{2}
    =\frac{1}{2}\sum_{i=1}^{n} m_{i}
    \left(\sum_{\alpha=1}^{k}\frac{\pa x_i}{\pa q_\alpha}\dot{q_\alpha}\right)
    \left(\sum_{\beta=1}^{k}\frac{\pa x_i}{\pa q_\beta}\dot{q_\beta}\right)\\
    &=\frac{1}{2}\sum_{\alpha=1}^{k}\sum_{\beta=1}^{k}
    \left(\sum_{i=1}^{n} m_{i}\frac{\pa x_i}{\pa q_\alpha}
    \frac{\pa x_i}{\pa q_\beta}\right)\dot{q_\alpha}\dot{q_\beta}\\
    &=\frac{1}{2}\sum_{\alpha=1}^{k}\sum_{\beta=1}^{k}
    g_{\alpha\beta}(q)\,
    \dot{q_\alpha}\dot{q_\beta}
\end{align*}
\begin{gather*}
m_{i} \ddot{x}_{i} = \frac{\partial T}{\partial \dot{x}_{i}}
\\
\frac{\partial T}{\partial q_l} = \sum_{i=1}^{n} m_{i} \dot{x}_{i} 
\frac{\partial \dot{x}_{i}}{\partial q_l} 
= \sum_{i=1}^{n} m_i \dot{x}_{i} \dv{t}
\frac{\partial x_{i}}{\partial q_l}
\qquad
\frac{\partial T}{\partial \dot{q}_l} = \sum_{i=1}^{n} m_{i} \dot{x}_{i} 
\frac{\partial \dot{x}_{i}}{\partial \dot{q}_l} 
= \sum_{i=1}^{n} m_i \dot{x}_{i}
\frac{\partial x_{i}}{\partial q_l}
\end{gather*}
\begin{gather*}
\frac{\partial T}{\partial q_l} - \frac{d}{dt} \left( \frac{\partial T}{\partial \dot{q}_l} \right) 
= -\sum_{i=1}^{n} m_{i} \ddot{x}_{i} \frac{\partial x_{i}}{\partial q_l}\\
\delta W=0 \Rightarrow
\sum_{l=1}^{k} \left( Q_{l} + \frac{\partial T}{\partial q_{l}} 
- \frac{d}{dt} \left( \frac{\partial T}{\partial \dot{q}_{l}} \right) \right) \delta q = 0
\\
\Rightarrow \boxed{\frac{\partial T}{\partial \dot{q}_{l}} - \frac{d}{dt} 
\left( \frac{\pa T}{\partial \dot{q}_l} \right) + Q_l = 0}
\end{gather*}
若\(F_i=-\frac{\pa u}{\pa x_i}\)
    \[Q_l=\sum_{i=1}^{n}F_i \frac{\pa x_i}{\pa q_l}=-\frac{\pa u}{\pa q_l}
    \]
若引入\(L=T-u \quad T=L+u\)
\[\frac{\pa (L+u)}{\pa q_l}-\dv{t}\left(\frac{\pa (L+u)}{\pa \dot{q}_l}\right)
-\frac{\pa u}{\pa q_l}=0
\Rightarrow \boxed{\frac{\pa L}{\pa q_l}
-\dv{t}\left(\frac{\pa L}{\pa \dot{q}_l}\right)=0}\]
\end{thm}
\section{最小作用量原理}
\begin{example}
    单个自由粒子
\begin{equation*}
    \begin{minipage}{0.3\textwidth}
    \begin{flalign*}
            &q = (x y, z)\\
            &T = \frac{1}{2} m (x^{2} + y^{2} + z^{2}) \\
            &L=T
    \end{flalign*}
    \end{minipage}
    \Rightarrow \quad
    \begin{cases} 
    x = x_{0} + u t \\ 
    y = y_{0} + u t \\ 
    z = z_{0} + u t 
    \end{cases}
\end{equation*}
\begin{zhu}
\begin{gather*}
        \frac{\pa L}{\pa x}-\dv{t}\left(\frac{\pa L}{\pa \dot{x}}\right)
        =-\dv{t}(m\dot{x})=-m\ddot{x}=0 \\ 
    m\ddot{y}=0    \qquad
    m\ddot{z}=0
\end{gather*}
\end{zhu}
\end{example}
\begin{example}
一维弹簧

考虑一个质量为 \( m \) 的质点，连接在一个弹簧常数为 \( k \) 的弹簧上，沿 \( x \) 轴运动。假设弹簧的平衡位置在 \( x = 0 \)。
\begin{gather*}
    \text{动能 } T = \frac{1}{2} m \dot{x}^2\qquad
    \text{势能 } V = \frac{1}{2} k x^2\qquad
    \text{拉格朗日量 } L = T - V = \frac{1}{2} m \dot{x}^2 - \frac{1}{2} k x^2 \\
    \text{拉格朗日方程 } \dv{t} \left( \frac{\partial L}{\partial \dot{x}} \right) - \frac{\partial L}{\partial x} = 0
    \Rightarrow \dv{t} (m \dot{x}) - (-k x) = 0
    \Rightarrow m \ddot{x} + k x = 0\\
    \text{解的形式 } x(t) = A \cos(\omega t + \phi), \quad \omega = \sqrt{\frac{k}{m}}.
\end{gather*}
\end{example}
\begin{example}
    平面内单摆
    
    考虑一个质量为 \( m \) 的单摆，摆长为 \( l \)，在重力场 \( g \) 下运动。摆的角度为 \( \theta \)。
    \begin{gather*}
        \text{动能 } T = \frac{1}{2} m v^2 = \frac{1}{2} m (l \dot{\theta})^2 = \frac{1}{2} m l^2 \dot{\theta}^2 \\
        \text{势能 } V = m g h = m g (l - l \cos \theta) = m g l (1 - \cos \theta) \\
        \text{拉格朗日量 } L = T - V = \frac{1}{2} m l^2 \dot{\theta}^2 - m g l (1 - \cos \theta) \\
        \text{拉格朗日方程 } \dv{t} \left( \frac{\partial L}{\partial \dot{\theta}} \right) - \frac{\partial L}{\partial \theta} = 0
        \Rightarrow \dv{t} (m l^2 \dot{\theta}) - (-m g l \sin \theta) = 0
        \Rightarrow m l^2 \ddot{\theta} + m g l \sin \theta = 0
    \end{gather*}
    \begin{itemize}[leftmargin=*, noitemsep]
        \item \textbf{小角度近似}：
        \(\displaystyle \ddot{\theta} + \frac{g}{l} \theta = 0\)\\
        解的形式为：
        \(\displaystyle \theta(t) = \theta_0 \cos(\omega t + \phi), \quad \omega = \sqrt{\frac{g}{l}}\)
        \item \textbf{无小角度近似}：保留非线性项 \( \sin \theta \)，运动方程为：
        \[
        \ddot{\theta} + \frac{g}{l} \sin \theta = 0
        \]
        引入变量 \( \phi \)，使得：
        \[
        \sin \frac{\theta}{2} = \sin \frac{\theta_0}{2} \sin \phi
        \]
        则运动方程可以转化为：
        \[
        \dot{\phi}^2 = \frac{g}{l} \left(1 - \sin^2 \frac{\theta_0}{2} \sin^2 \phi \right)
        \]
        分离变量并积分，得到运动的时间解：
        \[
        t = \sqrt{\frac{l}{g}} \int_0^\phi \frac{\dd \phi'}{\sqrt{1 - \sin^2 \frac{\theta_0}{2} \sin^2 \phi'}}
        \]
        这是一个椭圆积分，通常表示为：
        \[
        t = \sqrt{\frac{l}{g}} F\left(\phi, \sin \frac{\theta_0}{2}\right)
        \]
        其中 \( F(\phi, k) \) 是第一类不完全椭圆积分，定义为：
        \[
        F(\phi, k) = \int_0^\phi \frac{\dd \phi'}{\sqrt{1 - k^2 \sin^2 \phi'}}
        \]
    \end{itemize}
\end{example}
\begin{defn}
    作用量 \( S \) 
    设\(M\)是系统的构型空间
\[
M = \{q = (q_{1}, \dots, q_{k})\} \subseteq \mathbb{R}^{k}
\]
允许运动\(\gamma:[t_1,t_2]\to M\quad t\mapsto q(t)\)，\(\gamma\)是分段\(C^1\)的，满足
\(\gamma(t_1)=q_1\quad \gamma(t_2)=q_2\)

作用量 \( S[q] \) 定义为拉格朗日量 \( L \) 沿路径 \( q \) 的时间积分：
\[
S[q] = \int_{t_1}^{t_2} L(q(t), \dot{q}(t), t) \, dt
\]
\end{defn}
\begin{thm}
    哈密顿原理(最小作用量原理)

    系统的真实运动路径 \( \gamma_{\text{real}} \) 是使作用量 \( S \) 取鞍点(通常说取极值)的路径。
\end{thm}
\begin{example}
    最小作用量原理推导拉格朗日方程
    \begin{align*}
        L(q + h, \dot{q} + \dot{h}, t) &= L(q, \dot{q}, t)
        +\frac{\partial L}{\partial q} h - \frac{\partial L}
        {\partial \dot{q}} \dot{h} 
        + \omicron\left( \|( h,\dot{h}, \omicron(\cdots))\|\right)\\
        S(q + h) - S(q) &= \int_{t_{0}}^{t_{1}} \left( L(q + h, \dot{q} + \dot{h}, t) - L(q, \dot{q}, t) \right) dt
        \\
        &= \frac{\partial L}{\partial \dot{q}} h \Bigg|_{t_{0}}^{t_{1}} + \int_{t_{0}}^{t_{1}} 
        \left[ \frac{\partial L}{\partial q} h - \frac{d}{dt} 
        \left( \frac{\partial L}{\partial \dot{q}} \right) h 
        + \omicron\left( \|( h,\dot{h}, \omicron(\cdots))\|\right) \right] dt\\
        &=\int_{t_{0}}^{t_{1}} \left[ \frac{\partial L}{\partial q} h - \frac{d}{dt} 
        \left( \frac{\partial L}{\partial \dot{q}} \right) h 
        + \omicron\left( \|( h,\dot{h}, \omicron(\cdots))\|\right) \right] dt\\
        &=A(h)+ \omicron(\|h\|)\\
        A(h)&=\int_{t_{0}}^{t_{1}} \frac{\partial L}{\partial q} h - \frac{d}{dt} 
        \left( \frac{\partial L}{\partial \dot{q}} \right) h(t) dt
        \overset{A=0\,\forall h}{\Rightarrow}\frac{\pa L}{\pa q_l}
        -\dv{t}\left(\frac{\pa L}{\pa \dot{q}_l}\right)=0
        \end{align*}
\end{example}
\begin{example}
Weierstrass 的无法取极值的泛函

考虑以下泛函：
\[
S[y] = \int_0^1 x^2 \left( \dv{y}{x} \right)^2 \dd x,
\]
其中函数 \( y(x) \) 满足边界条件：
\[
y(0) = 0, \quad y(1) = 1.
\]

泛函的拉格朗日量为 \( L(x, y, y') = x^2 (y')^2 \)。欧拉-拉格朗日方程为：
\begin{gather*}
    \pdv{L}{y} - \dv{x} \left( \pdv{L}{y'} \right) = 0\Rightarrow
    - \dv{x} (2 x^2 y') = 0\\
    \text{积分一次得到：}
    2 x^2 y' = C 
    \text{其中} C \;,\;\text{是常数。}\\\text{解得：}
    y' = \frac{C}{2 x^2}\;,\; 
    \text{再积分一次得到：}
    y(x) = -\frac{C}{2 x} + D\;,\;
    \text{其中} D \text{是常数。}
\end{gather*}
应用边界条件 \( y(0) = 0 \) 和 \( y(1) = 1 \)：
\begin{gather*}
    y(0) = -\frac{C}{2 \cdot 0} + D \quad \text{（发散，无解）}
    \\
    y(1) = -\frac{C}{2 \cdot 1} + D = 1
\end{gather*}
\end{example}
\begin{example}
电磁场中带电粒子
    
    考虑 \(\mathbb{R}^3\) 中的拉格朗日量：
    \[
    L = \frac{1}{2} m (\dot{x}^2 + \dot{y}^2 + \dot{z}^2) + e (A_x \dot{x} + A_y \dot{y} + A_z \dot{z} - \varphi)
    \]
    其中 \( A_x, A_y, A_z, \varphi \) 是 \( x, y, z, t \) 的函数。
    \begin{solution}
对 \( L \) 应用欧拉-拉格朗日方程：
\[
\dv{t} \left( \pdv{L}{\dot{q}} \right) - \pdv{L}{q} = 0,
\]
其中 \( q \) 代表 \( x, y, z \)。
\begin{itemize}
    \item 对广义速度的偏导数
\begin{align*}
\pdv{L}{\dot{x}} &= m \dot{x} + e A_x \\
\pdv{L}{\dot{y}} &= m \dot{y} + e A_y \\
\pdv{L}{\dot{z}} &= m \dot{z} + e A_z
\end{align*}
\item 对广义坐标的偏导数
\begin{align*}
\pdv{L}{x} &= e \left( \pdv{A_x}{x} \dot{x} + \pdv{A_y}{x} \dot{y} + \pdv{A_z}{x} \dot{z} - \pdv{\varphi}{x} \right) \\
\pdv{L}{y} &= e \left( \pdv{A_x}{y} \dot{x} + \pdv{A_y}{y} \dot{y} + \pdv{A_z}{y} \dot{z} - \pdv{\varphi}{y} \right) \\
\pdv{L}{z} &= e \left( \pdv{A_x}{z} \dot{x} + \pdv{A_y}{z} \dot{y} + \pdv{A_z}{z} \dot{z} - \pdv{\varphi}{z} \right)
\end{align*}
\item 运动方程
对于 \( x \) 方向：
\begin{align*}
\dv{t} \left( m \dot{x} + e A_x \right) &= e \left( \pdv{A_x}{x} \dot{x} + \pdv{A_y}{x} \dot{y} + \pdv{A_z}{x} \dot{z} - \pdv{\varphi}{x} \right) \\
m \ddot{x} + e \dv{A_x}{t} &= e \left( \pdv{A_x}{x} \dot{x} + \pdv{A_y}{x} \dot{y} + \pdv{A_z}{x} \dot{z} - \pdv{\varphi}{x} \right)
\end{align*}
利用 \(\displaystyle \mathbf{E} = -\nabla \varphi - \pdv{\mathbf{A}}{t}
\;,\; \mathbf{B}=\nabla\times A \)，可以将方程改写为：
\[
m \ddot{x} = e \left( E_x + \dot{y} B_z - \dot{z} B_y \right)
\]
类似地，对于 \( y \) 和 \( z \) 方向：
\begin{gather*}
    m \ddot{y} = e \left( E_y + \dot{z} B_x - \dot{x} B_z \right)
    \\
    m \ddot{z} = e \left( E_z + \dot{x} B_y - \dot{y} B_x \right)
\end{gather*}
\end{itemize}
    \end{solution} 
\end{example}
\begin{example}
最速降线问题

在重力场中，一个质点从点 \( A \) 沿曲线 \( y(x) \) 无摩擦下滑到点 \( B \)，求使下滑时间最短的曲线 \( y(x) \)。
\begin{itemize}
    \item 
下滑时间 \( T \) 可以表示为：
\[
T = \int_{A}^{B} \dd t = \int_{A}^{B} \frac{\dd s}{v},
\]
其中 \( \dd s = \sqrt{1 + (y')^2} \dd x \) 是弧长微元，\( v = \sqrt{2gy} \) 是质点的速度（由能量守恒得出）。因此，泛函为：
\[
T[y] = \int_{x_1}^{x_2} \frac{\sqrt{1 + (y')^2}}{\sqrt{2gy}} \dd x.
\]
\item 拉格朗日量：
\[
L(y, y') = \frac{\sqrt{1 + (y')^2}}{\sqrt{2gy}}.
\]
\item  欧拉-拉格朗日方程
\begin{gather*}
    \pdv{L}{y} - \dv{x} \left( \pdv{L}{y'} \right) = 0
\\
\pdv{L}{y} = -\frac{1}{2} \frac{\sqrt{1 + (y')^2}}{(2gy)^{3/2}} \cdot 2g 
= -\frac{g \sqrt{1 + (y')^2}}{(2gy)^{3/2}}
\\
\pdv{L}{y'} = \frac{y'}{\sqrt{2gy} \sqrt{1 + (y')^2}}
\\
-\frac{g \sqrt{1 + (y')^2}}{(2gy)^{3/2}} - \dv{x} 
\left( \frac{y'}{\sqrt{2gy} \sqrt{1 + (y')^2}} \right) = 0
\end{gather*}
\item  
引入守恒量（能量守恒）：
\[
\frac{y'}{\sqrt{2gy} \sqrt{1 + (y')^2}} = C,
\]
其中 \( C \) 是常数。化简得到：
\[
\frac{y'}{\sqrt{1 + (y')^2}} = C \sqrt{2gy}.
\]
平方后得到：
\[
\frac{(y')^2}{1 + (y')^2} = 2g C^2 y.
\]
设 \( k = 2g C^2 \)，则：
\[
\frac{(y')^2}{1 + (y')^2} = k y.
\]
解得：
\[
(y')^2 = \frac{k y}{1 - k y}.
\]
\item  
引入参数 \( \theta \)，使得：
\[
y = \frac{1}{2k} (1 - \cos \theta), \quad \dd y = \frac{1}{2k} \sin \theta \dd \theta.
\]
代入 \( (y')^2 \) 的表达式，得到：
\[
\left( \frac{\dd y}{\dd x} \right)^2 = \frac{k y}{1 - k y} = \frac{1 - \cos \theta}{1 + \cos \theta}.
\]
因此：
\[
\frac{\dd y}{\dd x} = \sqrt{\frac{1 - \cos \theta}{1 + \cos \theta}} = \tan \frac{\theta}{2}.
\]
积分得到：
\[
x = \frac{1}{2k} (\theta - \sin \theta) + C.
\]
结合边界条件，最终得到最速降线为摆线（旋轮线）。
\end{itemize}
\end{example}
\section{变分导数的进一步讨论}
\begin{example}
    用变分法证明命题\ref{拉氏量对广义坐标求导}
    \begin{proof}
    \begin{align*}
        S(q)&=\int_{t_0}^{t_1}\left(q(t),q'(t)\cdots q^{(s)}(t)\right)\,dt\\
        S(q + h) - S(q) &= \int_{t_0}^{t_1} L(q + h, q' + h', \dots, q^{(s)} + h^{(s)}) \, dt 
        - \int_{t_0}^{t_1} L(q, q', \dots, q^{(s)}) \, dt \\
        &= \int_{t_0}^{t_1} \left( L(q + h, q' + h', \dots, q^{(s)} + h^{(s)}) 
        - L(q, q', \dots, q^{(s)}) \right) \, dt \\
        &= \int_{t_0}^{t_1} \left( \pdv{L}{q} h + \pdv{L}{q'} h' + \pdv{L}{q''} h'' 
        + \cdots + \pdv{L}{q^{(s)}} h^{(s)} + \omicron(h) \right) \, dt \\
        &= \int_{t_0}^{t_1} \left( \pdv{L}{q} h + \pdv{L}{q'} \dv{h}{t} 
        + \pdv{L}{q''} \dv[2]{h}{t} + \cdots + \pdv{L}{q^{(s)}} \dv[s]{h}{t} 
        + \omicron(h) \right) \, dt \\
        &= \int_{t_0}^{t_1} \pdv{L}{q} h \, dt 
        + \left( \left. \pdv{L}{q'} h \right|_{t_0}^{t_1} 
        - \int_{t_0}^{t_1} \dv{t} \left( \pdv{L}{q'} \right) h \, dt \right) \\
    &\quad + \left( \left. \pdv{L}{q''} \dv{h}{t} \right|_{t_0}^{t_1} 
    - \int_{t_0}^{t_1} \dv{t} \left( \pdv{L}{q''} \right) \dv{h}{t} \, dt \right) \\
    &\quad + \cdots \\
    &\quad + \left( \left. \pdv{L}{q^{(s)}} \dv[s-1]{h}{t} \right|_{t_0}^{t_1} 
    - \int_{t_0}^{t_1} \dv{t} \left( \pdv{L}{q^{(s)}} \right) \dv[s-1]{h}{t} \, dt \right) 
    + \int_{t_0}^{t_1} \omicron(h) \, dt \\
    &=\int_{t_0}^{t_1}\left(\left(
        \frac{\pa L}{\pa q}-\dv{t}\left(\frac{\pa L}{\pa q'}\right)
        +\dv[2]{t}\left(\frac{\pa L}{\pa q''}\right)+\cdots+\left(-\dv{t}\right)\frac{\pa L}{\pa q^{(s)}}
    \right)
    h+\omicron(\cdots)\right)\,dt\\
    \frac{\delta L}{\delta q_\alpha}&=
    \sum_{p \geq 0}\left(-\dv{t}\right)^p
    \left(\frac{\pa L}{\pa q_\alpha^{(p)}}\right)=
    \sum_{p \geq 0}\left(-\dv{t}\right)^p
    \left(\frac{\pa L}{\pa q_{\alpha,p}}\right)
    \end{align*}
\end{proof}
\end{example}
\begin{thm}
    欧拉-拉格朗日方程与广义坐标的选取无关
    \begin{yzh}
\begin{gather*}
            \frac{\delta L}{\delta q_\alpha}=
            \sum_{p \geq 0}\left(-\dv{t}\right)^p
            \left(\frac{\pa L}{\pa q_{\alpha,p}}\right)=
            \sum_{p \geq 0}\left(-\pa \right)^p
            \left(\frac{\pa L}{\pa q_{\alpha,p}}\right)
            \\
\frac{\partial\tilde{q}_{\alpha, s}}{\partial q_{\beta,t}}=
\begin{pmatrix}
s \\
t
\end{pmatrix}
\left(\dv{t}\right)^{s-t}
\left(\frac{\partial\tilde{q}_\alpha}{\partial q_\beta}\right)=
\begin{pmatrix}
s \\
t
\end{pmatrix}
\pa^{s-t}
\left(\frac{\partial\tilde{q}_\alpha}{\partial q_\beta}\right)
\quad s\geq t
\end{gather*}
    \end{yzh}
\begin{proof}
    \begin{gather*}
        \frac{\delta L}{\delta u_\alpha}=
        \sum_{l \geq 0}\left(-\pa \right)^l
        \left(\frac{\pa L}{\pa u_{\alpha,l}}\right)\\
        \frac{\pa L}{\pa u_{\alpha,l}}=\sum_{k\geq l}\frac{\pa L}{\pa q_{\beta,k}}
        \frac{\pa q_{\beta,k}}{\pa u_{\alpha,l}}=\sum_{k\geq l}\frac{\pa L}{\pa q_{\beta,k}}
        \begin{pmatrix}
        k \\
        l
        \end{pmatrix}
        \pa^{k-l}
        \left(\frac{\partial q_\beta}{\partial u_\alpha}\right) 
    \end{gather*}
    \begin{align*}
        \frac{\delta L}{\delta u_\alpha}&=
        \sum_{l \geq 0}\left(-1\right)^l\pa^l
        \left(\sum_{k\geq l}\frac{\pa L}{\pa q_{\beta,k}}
        \begin{pmatrix}
        k \\
        l
        \end{pmatrix}
        \pa^{k-l}
        \left(\frac{\partial q_\beta}{\partial u_\alpha}\right) \right)\\
&=\sum_{l \geq 0}\sum_{k\geq l}\left(-1\right)^l
\begin{pmatrix}
    k \\
    l
\end{pmatrix}
\sum_{j=0}^{l}\begin{pmatrix}
l\\
j
\end{pmatrix}\pa^j\left(\frac{\pa L}{\pa q_{\beta,k}}\right)
\pa^{l-j}\left(\pa^{k-l}
\left(\frac{\partial q_\beta}{\partial u_\alpha}\right) \right)\\
&=\sum_{l \geq 0}\sum_{k\geq l}\left(-1\right)^l
\begin{pmatrix}
    k \\
    l
\end{pmatrix}
\sum_{j=0}^{l}\begin{pmatrix}
l\\
j
\end{pmatrix}\pa^j\left(\frac{\pa L}{\pa q_{\beta,k}}\right)
\pa^{k-j}\left(\frac{\partial q_\beta}{\partial u_\alpha}\right) \\
&=\sum_{k\geq 0}\sum_{j \geq 0}\left(\sum_{l=j}^{k}\left(-1\right)^l
\begin{pmatrix}
    k \\
    l
\end{pmatrix}
\begin{pmatrix}
l\\
j
\end{pmatrix}\right)\pa^j\left(\frac{\pa L}{\pa q_{\beta,k}}\right)
\pa^{k-j}\left(\frac{\partial q_\beta}{\partial u_\alpha}\right) \\
&=\underbrace{\sum_{j \geq 0}\left(-1\right)^j \pa^j\left(\frac{\pa L}{\pa q_{\beta,k}}\right)}_{
=\frac{\delta L}{\delta q_\beta} }
\frac{\partial q_\beta}{\partial u_\alpha}
=\frac{\delta L}{\delta q_\beta}\frac{\partial q_\beta}{\partial u_\alpha}
    \end{align*}
\end{proof}
\begin{zhu}
    \begin{align*}
\sum_{l=j}^{k} (-1)^l \binom{k}{l} \binom{l}{j}&=
\sum_{l=j}^{k} (-1)^l \cdot \frac{k!}{j!(k-l)!(l-j)!}\\
&\overset{m = l - j}{=}
\sum_{m=0}^{k-j} (-1)^{m+j} \cdot \frac{k!}{j!(k-j-m)!m!}\\
&=(-1)^j \cdot \frac{k!}{j!(k-j)!} \cdot \underbrace{\sum_{m=0}^{k-j} (-1)^m 
\cdot \frac{(k-j)!}{m!(k-j-m)!}}_{=\sum_{m=0}^{k-j} (-1)^m \binom{k-j}{m}
= (1 - 1)^{k-j} = 0^{k-j}}\\
&=(-1)^j \delta_k^j=(-1)^k \delta_k^j
    \end{align*}
\end{zhu}
\end{thm}
\begin{zhu}
    物理的理论力学书上常见的证明过程

    设广义坐标变换为：
    \(\displaystyle q_i = q_i(Q_1, Q_2, \dots, Q_n, t) \)
    
    拉格朗日量是标量，在坐标变换下保持不变：
    \(\displaystyle L(q, \dot{q}, t) = \tilde{L}(Q, \dot{Q}, t) \)
    
    广义速度的变换关系：
    \(\displaystyle \dot{q}_i = \sum_{j=1}^n \pdv{q_i}{Q_j} \dot{Q}_j + \pdv{q_i}{t} \)
    \begin{gather*}
        \text{原始坐标下的欧拉-拉格朗日方程：}\quad
        \pdv{L}{q_i} - \partial_t \left( \pdv{L}{\dot{q}_i} \right) = 0 \\    
        \text{变换后坐标下的欧拉-拉格朗日方程：}\quad
        \pdv{\tilde{L}}{Q_i} - \partial_t \left( \pdv{\tilde{L}}{\dot{Q}_i} \right) = 0 
    \end{gather*}
    
    拉格朗日量对 \( q_i \) 的偏导数：
    \(\displaystyle \pdv{L}{q_i} = \sum_{j=1}^n \pdv{\tilde{L}}{Q_j} \pdv{Q_j}{q_i} \)
    
    拉格朗日量对 \(\dot{q}_i\) 的偏导数：
    \(\displaystyle \pdv{L}{\dot{q}_i} = \sum_{j=1}^n \pdv{\tilde{L}}{\dot{Q}_j} \pdv{\dot{Q}_j}{\dot{q}_i} \)

    由于：
    \(\displaystyle \pdv{\dot{Q}_j}{\dot{q}_i} = \pdv{Q_j}{q_i}\qquad \)
    因此：
    \(\displaystyle \pdv{L}{\dot{q}_i} = \sum_{j=1}^n \pdv{\tilde{L}}{\dot{Q}_j} \pdv{Q_j}{q_i} \)

将上述结果代入原始坐标下的欧拉-拉格朗日方程：
\[
\sum_{j=1}^n \pdv{\tilde{L}}{Q_j} \pdv{Q_j}{q_i} - \partial_t \left( \sum_{j=1}^n \pdv{\tilde{L}}{\dot{Q}_j} \pdv{Q_j}{q_i} \right) = 0
\]

由于 \(\displaystyle \pdv{Q_j}{q_i}\) 不显含时间：
\begin{gather*}
\sum_{j=1}^n \left( \pdv{\tilde{L}}{Q_j} - \partial_t \left( \pdv{\tilde{L}}{\dot{Q}_j} \right) \right) \pdv{Q_j}{q_i} = 0
\\
\pdv{\tilde{L}}{Q_j} - \partial_t \left( \pdv{\tilde{L}}{\dot{Q}_j} \right) = 0
\end{gather*}
\end{zhu}
\begin{thm}
    \mbox{}
    \begin{enumerate}
        \item 若\(\displaystyle L=\dv{K}{t}\)，则
        \(\displaystyle \frac{\delta L}{\delta q_\alpha}=0\)
        \item 若\(\displaystyle \frac{\delta L}{\delta q_\alpha}=0\;\forall \alpha=1,\cdots,k\)，
        则存在\(K\) ，使得\(\displaystyle L = \dv{K}{t}\)
    \end{enumerate}
\end{thm}
\begin{zhu}
    物理的理论力学书上证明(拉格朗日量加上一个全导数项不会改变系统的运动方程，因为作用量的变分不变。)
    \[L'(q, \dot{q}, t) = L(q, \dot{q}, t) + \frac{df(q, t)}{dt}\]
    \begin{gather*}
        S = \int_{t_1}^{t_2} L(q, \dot{q}, t) \, dt \\
        S' = \int_{t_1}^{t_2} L'(q, \dot{q}, t) \, dt 
        = \int_{t_1}^{t_2} L(q, \dot{q}, t) \, dt + \int_{t_1}^{t_2} \frac{df(q, t)}{dt} \, dt \\
        \int_{t_1}^{t_2} \frac{df(q, t)}{dt} \, dt = f(q(t_2), t_2) - f(q(t_1), t_1) \\
        S' = S + f(q(t_2), t_2) - f(q(t_1), t_1) \qquad
        \delta S' = \delta S
    \end{gather*}
\end{zhu}
\begin{thm}
    \mbox{}
    \begin{enumerate}
        \item 设\(\displaystyle f_\alpha=\frac{\delta L}{\delta q_\alpha}\)，则
        \[\frac{\pa f_\alpha}{q_{\beta,s}}=\sum_{t\geq 0}
        (-1)^{s+t}\begin{pmatrix}
            s+t\\
            t
        \end{pmatrix}\pa^t\frac{\pa f_\beta}{\pa q_{\alpha,s+t}}
        \quad\forall\;\alpha,\beta=1,\cdots,k \;,\;\forall\;s\geq 0
        \]
        \item 若一组函数\(f_\alpha\)满足上式，则存在\(L\)，使得\(f_\alpha=\frac{\delta L}{\delta q_\alpha}\)
    \end{enumerate}
\end{thm}
\begin{example}
    在伽利略时空中的自由粒子
    \begin{gather*}
        L_q=T=\frac{1}{2}m\sum_{\alpha=1}^{n}(\dot{q}_\alpha)^2\\
        \text{E-L eq. }\quad m \ddot{q}_\alpha=0\\
        \text{伽利略变换}
        \begin{cases}
            q(u)=Au+Bt+C\\
            \dot{q}=A\dot{u}+B
        \end{cases}
        \quad A\in O(n)\;,\;B\in \mathbb{R}^n\;,\; C\in \mathbb{R}^n
    \end{gather*}
    \begin{align*}
        L_q&=\frac{1}{2}m\left(\dot{q}\right)^T\left(\dot{q}\right)
        =\frac{1}{2}m\left(A\dot{u}+B\right)^T\left(A\dot{u}+B\right)
        =\frac{1}{2}\bigg(\dot{u}^T \underbrace{A^T A}_{=I}\dot{u}
        +B^T A\dot{u}+\dot{u}^T A^T B +B^T B\bigg)\\
        &=L_u +\left(mB^T A \dot{u}+\frac{1}{2}m B^T B\right)
        =L_u +\dv{t}\left(m B^T A u+ \frac{mB^TB}{2}t\right)
    \end{align*}
\end{example}
\begin{thm}
    若\(L=L(q,\dot{q},t)\)满足在任意伽利略变换下不变(相差一个\(\pa K\))，
    则存在\(m\in \mathbb{R}\)，使得\(L=\frac{1}{2}m\dot{q}^2\)。
\begin{proof}
    \textbf{空间平移}
    \begin{gather*}
        (q,\dot{q},t)\mapsto(q+vt+q_0,\dot{q}+v,t+t_0),
        \text{则存在}K=K(q,t)\\
        L(q+vt+q_0,\dot{q}+v,t+t_0)-L(q,\dot{q},t)=\dv{K}{t}
        =\frac{\pa K}{\pa t}+\sum_{\alpha=1}^{n}\frac{\pa K}{\pa q_\alpha}\dot{q}_\alpha\\
        \because\;\pdv[2]{}{\dot{q}_\alpha}{\dot{q}_\beta}\left(\dv{K}{t}\right)=0
        \quad \therefore \;\underbrace{L_{\dot{\alpha},\dot{\beta}}(q+vt+q_0,\dot{q}+v,t+t_0)
        =L_{\dot{\alpha},\dot{\beta}}(q,\dot{q},t)}
        _{\displaystyle L_{\dot{\alpha},\dot{\beta}}\equiv C} \\
        \Rightarrow L=\frac{1}{2}\sum_{\alpha,\beta=1}^{n}
        L_{\dot{\alpha},\dot{\beta}}\dot{q}_\alpha\dot{q}_\beta
        +\sum_{\alpha=1}^{n}A_\alpha(q,t)\dot{q}_\alpha+B(q,t)\\
        \begin{aligned}
            \text{取}V=0\quad
            &L(q+vt+q_0,\dot{q}+v,t+t_0)-L(q,\dot{q},t)\\
            =&\frac{1}{2}\sum_{\alpha,\beta=1}^{n}
            L_{\dot{\alpha},\dot{\beta}}\dot{q}_\alpha\dot{q}_\beta
            +\sum_{\alpha=1}^{n}A_\alpha(q+q_0,t+t_0)\dot{q}_\alpha+B(q+q_0,t+t_0)\\
            &-\left(\frac{1}{2}\sum_{\alpha,\beta=1}^{n}
        L_{\dot{\alpha},\dot{\beta}}\dot{q}_\alpha\dot{q}_\beta
        +\sum_{\alpha=1}^{n}A_\alpha(q,t)\dot{q}_\alpha+B(q,t)\right)\\
        =&\sum_{\alpha=1}^{n}A_\alpha(q+q_0,t+t_0)\dot{q}_\alpha+B(q+q_0,t+t_0)
        -\sum_{\alpha=1}^{n}A_\alpha(q,t)\dot{q}_\alpha-B(q,t)\\
        =&\frac{\pa K}{\pa t}+\sum_{\alpha=1}^{n}\frac{\pa K}{\pa q_\alpha}\dot{q}_\alpha\\
        \Rightarrow&\quad\sum_{\alpha=1}^{n}A_\alpha(q+q_0,t+t_0)
        -\sum_{\alpha=1}^{n}A_\alpha(q,t)=\sum_{\alpha=1}^{n}\frac{\pa K}{\pa q_\alpha}\\
        &
        \begin{aligned}
            \Rightarrow\quad&\sum_{\alpha=1}^{n}\frac{pa A_\alpha}{\pa q_\beta}(q+q_0,t+t_0)
            -\sum_{\alpha=1}^{n}\frac{\pa A_\alpha}{\pa q_\beta}(q,t)\\
            =&\sum_{\alpha=1}^{n}\frac{\pa^2 K}{\pa q_\alpha \pa q_\beta}
            =\sum_{\beta=1}^{n}\frac{pa A_\beta}{\pa q_\alpha}(q+q_0,t+t_0)
            -\sum_{\beta=1}^{n}\frac{\pa A_\beta}{\pa q_\alpha}(q,t)
        \end{aligned}\\
        &\Rightarrow\boxed{\frac{\pa A_\alpha}{\pa q_\beta}-\frac{\pa A_\beta}{q_\alpha}\equiv C}\\
        \Rightarrow&\quad
            \begin{aligned}
                &B(q+q_0,t+t_0)-B(q,t)=\frac{\pa K}{\pa t}\\
                &\sum_{\alpha=1}^{n}A_\alpha(q+q_0,t+t_0)
                -\sum_{\alpha=1}^{n}A_\alpha(q,t)=\sum_{\alpha=1}^{n}\frac{\pa K}{\pa q_\alpha}
            \end{aligned}\\
        &\Rightarrow\boxed{\frac{\pa A_\alpha}{\pa t}-\frac{\pa B}{\pa q_\alpha}\equiv C}
        \end{aligned}
    \end{gather*}
    \textbf{空间反演}
    \begin{gather*}
        q\mapsto-q,\dot{q}\mapsto-\dot{q}\\
        L(-q,-\dot{q},t)=L(q,\dot{q},t)+\dv{K}{t}\\
        \text{取}\tilde{L}=\frac{1}{2}\left(L(q,\dot{q})+L(-q,-\dot{q})\right)
        =L(q,\dot{q})+\pa \left(\frac{1}{2}K\right),\tilde{L}\text{与}L\text{等价}\\
        \text{同理}L=\frac{1}{2}\sum_{\alpha,\beta=1}^{n}
        L_{\dot{\alpha},\dot{\beta}}\dot{q}_\alpha\dot{q}_\beta
        +\sum_{\alpha=1}^{n}A_\alpha(q,t)\dot{q}_\alpha+B(q,t)\\
    \end{gather*}
\end{proof}
\end{thm}


\begin{example}
    膜振动
    \(\Omega=\{(x,y)\in \mathbb{R}^2| x^2+y^2\leq 1\}\;,\; u(x,y,t)\)
    \begin{gather*}
        T=\int_\Omega\frac{1}{2}\rho \left(\frac{\pa u}{\pa t}\right)^2\,dxdy\qquad
        U=\int_\Omega k\left(\sqrt{1+\left(\frac{\pa u}{\pa x}\right)^2+\left(\frac{\pa u}{\pa y}\right)^2}-1\right)\,dxdy\\
        L=\int_\Omega\bigg(\underbrace{\frac{1}{2}\rho \left(\frac{\pa u}{\pa t}\right)^2+
        k\sqrt{1+\left(\frac{\pa u}{\pa x}\right)^2+\left(\frac{\pa u}{\pa y}\right)^2}}
        _{\displaystyle \mathtt{X}}-k\bigg)\,dxdy\qquad\\
        \begin{aligned}
            \frac{\delta L}{\delta u}&=\frac{\pa \mathtt{X}}{\pa u}-\dv{t}\frac{\pa \mathtt{X}}{\pa u_{,t}}
            -\dv{x}\frac{\pa \mathtt{X}}{\pa u_{,x}}-\dv{y}\frac{\pa \mathtt{X}}{\pa y}\\
            &=0-\rho u_{,tt}+k\left(\bigg(\frac{u_{,x}}{\sqrt{1+u_{,x}^2+u_{,y}^2}}\bigg)_{\displaystyle ,x}
            +\bigg(\frac{u_{,y}}{\sqrt{1+u_{,x}^2+u_{,y}^2}}\bigg)_{\displaystyle ,y} \right)=0
        \end{aligned}\\
        \text{微振动} u=\varepsilon v \quad\Rightarrow\quad \rho v_{,tt}=k(v_{,xx}+v_{,yy})+\omicron(\varepsilon)
    \end{gather*}
\end{example}
    \begin{add}
        弦振动
    \(\Omega = [0, L] \subset \mathbb{R}\;,\; u(x, t)\)
    \begin{gather*}
        T = \int_0^L \frac{1}{2}\rho \left(\frac{\partial u}{\partial t}\right)^2 dx \qquad
        U = \int_0^L k\left(\sqrt{1 + \left(\frac{\partial u}{\partial x}\right)^2} - 1\right) dx \\
        L = \int_0^L \bigg(\underbrace{\frac{1}{2}\rho \left(\frac{\partial u}{\partial t}\right)^2 + k\sqrt{1 + \left(\frac{\partial u}{\partial x}\right)^2}}_{\displaystyle \mathtt{Y}} - k \bigg) dx \\
        \begin{aligned}
            \frac{\delta L}{\delta u} &= \frac{\partial \mathtt{Y}}{\partial u} - \frac{d}{dt}\frac{\partial \mathtt{Y}}{\partial u_{,t}} - \frac{d}{dx}\frac{\partial \mathtt{Y}}{\partial u_{,x}} \\
            &= 0 - \rho u_{,tt} + k \frac{d}{dx}\bigg(\frac{u_{,x}}{\sqrt{1 + u_{,x}^2}}\bigg) = 0
        \end{aligned} \\
        \text{微振动} \quad u = \varepsilon v \quad \Rightarrow\quad \rho v_{,tt} = k v_{,xx} + \omicron(\varepsilon)
    \end{gather*}
    \end{add}
    %示意图
    \begin{center}
        \begin{minipage}[t]{0.98\linewidth}
        \centering
        \begin{tikzpicture}[scale=1.2]
            % 圆形膜Ω的范围
            \draw[fill=blue!10] (0,0) circle (1);
            \draw[dashed, thick] (0,0) circle (1);
            \node at (1,1) {$\Omega$};
            
            % 坐标轴
            \draw[->] (-1.5,0) -- (1.5,0) node[below,right]{$x$};
            \draw[->] (0,-1.5) -- (0,1.5) node[above,left]{$y$};
            \node[below] at (0,-1.7) {(a) 圆形膜};
        \end{tikzpicture}
        \hfil
        \begin{tikzpicture}[scale=1.2]
            % 圆形膜Ω的范围
            \draw[dashed, thick] (0,0) ellipse [x radius=1, y radius=0.5];
            \node at (1,0.7) {$\Omega$};
            
            % 坐标轴
            \draw[->] (-1.5,0) -- (1.5,0) node[below,right]{$(x,y)$};
            \draw[->] (0,-1.5) -- (0,1.5) node[above,left]{$u$};
            \node[below] at (0,-1.7) {(b) 膜振动};
        \end{tikzpicture}
        \hfil
        \begin{tikzpicture}[scale=1.1]
            % 坐标轴
            \draw[->] (0,0) -- (4,0) node[below,right]{$x$};
            \draw[->] (0,-1) -- (0,1) node[above,left]{$u$};
            
            % 弦的平衡位置
            \draw[thick] (0,0) -- (3.5,0);
            
            % 振动后的弦
            \draw[red, thick, smooth] plot[domain=0:3.5, samples=50] 
                (\x, {0.4*sin(2*pi*\x r)});
            
            % 标记边界和振动
        \draw[dashed] (0,0) -- (0,-1.3) node[below,align=center] {$x=0$\\（固定）};
        \draw[dashed] (3.5,0) -- (3.5,-1.3) node[below,align=center] {$x=L$\\（固定）};
        \node[red] at (1.7,0.6) {$u(x,t)$};
            \node[below] at (1.75,-2.4) {(c) 弦振动};
        \end{tikzpicture}
        \end{minipage}
    \end{center}


\begin{example}
    

\end{example}





\section{守恒律}








\begin{lemma}
    \begin{equation}
        \frac{\partial}{\partial q_{\alpha,s+t}}\partial 
        = \partial\frac{\partial}{\partial q_{\alpha,s+t}} 
        + \frac{\partial}{\partial q_{\alpha,s+t-1}}
    \end{equation}
    \begin{proof}
        任取光滑函数$L(q_\alpha,q_{\alpha,1},\cdots)$，计算：
        
        1. 左式作用：
        \begin{align*}
        \left(\frac{\partial}{\partial q_{\alpha,s+t}}\partial\right)L 
        &= \frac{\partial}{\partial q_{\alpha,s+t}}\left(\sum_{k=0}^\infty \frac{\partial L}{\partial q_{\alpha,k}}q_{\alpha,k+1}\right) \\
        &= \sum_{k=0}^\infty \frac{\partial^2 L}{\partial q_{\alpha,s+t}\partial q_{\alpha,k}}q_{\alpha,k+1} 
        + \frac{\partial L}{\partial q_{\alpha,s+t-1}}
        \end{align*}
        
        2. 右式作用：
        \begin{align*}
        \left(\partial\frac{\partial}{\partial q_{\alpha,s+t}} 
        + \frac{\partial}{\partial q_{\alpha,s+t-1}}\right)L 
        &= \sum_{k=0}^\infty \frac{\partial^2 L}{\partial q_{\alpha,k}\partial q_{\alpha,s+t}}q_{\alpha,k+1} 
        + \frac{\partial L}{\partial q_{\alpha,s+t-1}}
        \end{align*}
        
        由于偏导数可交换：
        \[
        \frac{\partial^2}{\partial q_{\alpha,s+t}\partial q_{\alpha,k}}
        = \frac{\partial^2}{\partial q_{\alpha,k}\partial q_{\alpha,s+t}}
        \]
    \end{proof} 
\end{lemma}   





%  ↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑ 正文部分
\ifx\allfiles\undefined
\end{document}
\fi
